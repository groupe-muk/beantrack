# Machine Learning Integration – Price Forecasting & Reporting

## Overview
This pull request introduces BeanTrack's first machine-learning (ML) capability: automated daily price forecasting for coffee products.  The change delivers an end-to-end workflow that collects historical price data, trains a predictive model, stores results, and makes the forecasts available in dashboards, PDF/email reports, and scheduled notifications.

## Motivation
Accurate short-term price outlooks help suppliers and vendors optimise purchasing and pricing strategies.  Adding ML-driven insights directly to BeanTrack strengthens the platform's decision-support value.

## Key Changes
1. **Database Schema**
   • `price_histories` table – stores historical spot prices (training data).  
   • `price_forecasts` table – stores daily model predictions with lower/upper bounds.

2. **Eloquent Models**
   • `app/Models/PriceHistory.php`  
   • `app/Models/PriceForecast.php`

3. **Service Layer**
   • `app/Services/PricePredictionService.php` encapsulates training, persistence, and inference using a Python/Scikit-Learn backend.

4. **Scheduled Jobs & Commands**
   • `app/Console/Commands/GenerateDailyForecasts.php` – runs every night at 02:00 via Laravel Scheduler to refresh predictions.  
   • `app/Console/Commands/ProcessScheduledReports.php` updated to inject the latest forecasts into generated reports.

5. **Seeders & Factories**
   • Added factories/seeders for `PriceHistory` and `PriceForecast` enabling realistic demo data and automated tests.

6. **UI Enhancements**
   • `resources/views/components/ml-prediction-graph-card.blade.php` – interactive chart overlaying historical and predicted prices.  
   • Dashboard views for **admin**, **supplier**, and **vendor** roles now render the prediction card.

7. **Testing**
   • Feature: `tests/Feature/ReportsTest.php` asserts that forecasts appear in generated PDFs and emails.  
   • Unit: `tests/Unit/ExampleTest.php` validates `PricePredictionService::predict()` returns a numeric Collection.

8. **Documentation**
   • `docs/ml.md` – explains architecture, data flow, and Python environment setup.

## Breaking / Backwards Compatibility
No breaking changes – all additions are additive. Existing data remains untouched.

## Deployment Notes
1. Install Python dependencies: `pip install -r docs/ml_requirements.txt` (scikit-learn, pandas, joblib).  
2. Run migrations: `php artisan migrate`.  
3. Optional: seed demo data with `php artisan db:seed --class=FixedSeeder`.  
4. Ensure the Laravel scheduler is running (cron entry: `* * * * * cd /path/to/app && php artisan schedule:run >> /dev/null 2>&1`).

## Validation & QA
- Executed `php artisan test` – all 143 tests pass.  
- Manual smoke test on local Docker stack confirmed predictions generate and appear in UI & emails.

## Screenshots
*(See attached in PR conversation – prediction card, report snippet)*

## Future Work
- Hyperparameter optimisation using Optuna.  
- Mid/long-term (3-12 month) forecasting models.  
- Expose predictions via public GraphQL endpoint.

## Related Issues / Tickets
Closes #123, #124 – "Add daily price forecasting" and "Display price predictions in reports".

---
*Generated by branch **caleb-ml** on $(date).* 